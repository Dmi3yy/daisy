<div class="navbar shadow-sm" id="main-navbar">
  <!-- Logo and brand (glows when Evo is active) -->
  <div class="flex-1">
    <a class="btn btn-ghost text-xl gap-2 transition-all duration-300" id="evo-logo">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 94 90" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-8 h-8 transition-all duration-300">
        <path d="m37.361 37.392 6.783 16.393 6.792-16.393M32.017 45.49h-7.908M33.161 37.392h-9.3v16.393h9.293M61.732 37.392c4.239 0 7.675 3.51 7.675 8.097 0 4.588-3.437 8.296-7.676 8.296-4.239 0-7.675-3.708-7.675-8.296 0-4.587 3.435-8.097 7.674-8.097h.002z"/>
        <path d="M45.829 8.807c19.573.002 35.44 15.174 35.439 35.01-.001 19.834-15.87 35.868-35.443 35.868-19.574 0-35.443-16.034-35.444-35.869 0-19.835 15.865-35.007 35.439-35.009h.009z"/>
        <path d="M22.837 71.115C10.95 65.332 2.745 53.035 2.744 38.773c0-19.835 15.865-35.007 35.439-35.01h.009c9.046.002 17.3 3.243 23.562 8.687"/>
        <path d="M34.652 10.59c5.906-4.288 13.233-6.782 21.168-6.783h.009c19.573.002 35.44 15.175 35.439 35.01 0 10.025-4.055 19.08-10.593 25.583"/>
        <path d="M68.538 16.749c10.126 6.054 16.73 17.13 16.73 30.067-.001 19.835-15.87 35.869-35.444 35.869-8.814 0-16.878-3.252-23.079-8.638M68.392 16.87"/>
        <path d="M60.448 81.004a34.999 34.999 0 0 1-19.626 5.99c-19.574 0-35.443-16.033-35.444-35.868 0-9.088 3.33-17.198 8.824-23.318m58.13 39.768"/>
      </svg>
      <span class="font-bold hidden sm:inline">EVO</span>
    </a>
  </div>

  <!-- Desktop menu -->
  <div class="flex-none hidden lg:flex">
    <ul class="menu menu-horizontal px-1">
      <li><a>About</a></li>
      <li><a>Docs</a></li>
      <li><a>Forum</a></li>
      <li><a>Community</a></li>
      <li><a>Extras</a></li>
      <li><a>GitHub</a></li>
    </ul>
  </div>

  <!-- Right side controls -->
  <div class="flex-none">
    <div class="flex items-center gap-2">
    
    <!-- Theme Panel -->
    <div class="relative">
      <button type="button" class="btn btn-ghost btn-circle" id="theme-button" aria-haspopup="dialog" aria-expanded="false" aria-controls="theme-panel">
        <!-- Sun icon (light mode) - shown by default -->
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 fill-current" viewBox="0 0 24 24" id="theme-icon-light">
          <path d="M5.64,17l-.71.71a1,1,0,0,0,0,1.41,1,1,0,0,0,1.41,0l.71-.71A1,1,0,0,0,5.64,17ZM5,12a1,1,0,0,0-1-1H3a1,1,0,0,0,0,2H4A1,1,0,0,0,5,12Zm7-7a1,1,0,0,0,1-1V3a1,1,0,0,0-2,0V4A1,1,0,0,0,12,5ZM5.64,7.05a1,1,0,0,0,.7.29,1,1,0,0,0,.71-.29,1,1,0,0,0,0-1.41l-.71-.71A1,1,0,0,0,4.93,6.34Zm12,.29a1,1,0,0,0,.7-.29l.71-.71a1,1,0,1,0-1.41-1.41L17,5.64a1,1,0,0,0,0,1.41A1,1,0,0,0,17.66,7.34ZM21,11H20a1,1,0,0,0,0,2h1a1,1,0,0,0,0-2Zm-9,8a1,1,0,0,0-1,1v1a1,1,0,0,0,2,0V20A1,1,0,0,0,12,19ZM18.36,17A1,1,0,0,0,17,18.36l.71.71a1,1,0,0,0,1.41,0,1,1,0,0,0,0-1.41ZM12,6.5A5.5,5.5,0,1,0,17.5,12,5.51,5.51,0,0,0,12,6.5Zm0,9A3.5,3.5,0,1,1,15.5,12,3.5,3.5,0,0,1,12,15.5Z"/>
        </svg>
        <!-- Moon icon (dark mode) - hidden by default -->
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 fill-current hidden" viewBox="0 0 24 24" id="theme-icon-dark">
          <path d="M21.64,13a1,1,0,0,0-1.05-.14,8.05,8.05,0,0,1-3.37.73A8.15,8.15,0,0,1,9.08,5.49a8.59,8.59,0,0,1,.25-2A1,1,0,0,0,8,2.36,10.14,10.14,0,1,0,22,14.05,1,1,0,0,0,21.64,13Zm-9.5,6.69A8.14,8.14,0,0,1,7.08,5.22v.27A10.15,10.15,0,0,0,17.22,15.63a9.79,9.79,0,0,0,2.1-.22A8.11,8.11,0,0,1,12.14,19.73Z"/>
        </svg>
      </button>
    </div>
    <!-- Mobile menu -->
    <div class="dropdown dropdown-end lg:hidden">
      <div tabindex="0" role="button" class="btn btn-ghost btn-square">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" class="inline-block w-5 h-5" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
        </svg>
      </div>
      <ul tabindex="0" class="menu menu-sm dropdown-content bg-base-100 rounded-box z-[1] mt-3 w-52 p-2 shadow-lg">
          <li><a>About</a></li>
          <li><a>Docs</a></li>
          <li><a>Forum</a></li>
          <li><a>Community</a></li>
          <li><a>Extras</a></li>
          <li><a>GitHub</a></li>
          <li class="md:hidden"><a onclick="document.getElementById('settings_modal').showModal()">Settings</a></li>
      </ul>
    </div>
    </div>
  </div>
</div>






<div id="theme-panel-overlay" class="fixed inset-0 z-[1040] bg-base-100/50 backdrop-blur-sm opacity-0 pointer-events-none transition-opacity duration-300"></div>
<aside id="theme-panel" class="fixed inset-y-0 right-0 z-[1050] w-full max-w-[22rem] sm:max-w-sm translate-x-full transition-transform duration-300 ease-out" aria-hidden="true" role="dialog" aria-label="Theme control panel">
  <div class="flex h-full flex-col bg-base-100 border-l border-base-300 shadow-2xl">
    <div class="flex items-center justify-between px-4 py-3 border-b border-base-300">
      <div class="text-sm font-semibold uppercase tracking-wider text-base-content/70">Theme Control</div>
      <button type="button" class="btn btn-ghost btn-sm btn-circle" aria-label="Close theme panel" data-close-theme-panel>
        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
        </svg>
      </button>
    </div>
    <div class="flex-1 overflow-y-auto px-4 pb-6">
      <div class="space-y-4">
        <!-- 1. Theme Mode Selector: System / Light / Dark -->
        <div class="pb-4 border-b border-base-300">
          <div class="text-xs font-bold text-base-content/50 uppercase tracking-wider mb-3">Theme Mode</div>
          <div class="flex gap-2">
            <button onclick="__setThemeMode('system');" class="btn btn-sm flex-1" id="mode-system">
              <svg class="w-4 h-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                <rect x="2" y="3" width="20" height="14" rx="2" stroke-width="2"/>
                <path d="M8 21h8M12 17v4" stroke-width="2"/>
              </svg>
              System
            </button>
            <button onclick="__setThemeMode('light');" class="btn btn-sm flex-1" id="mode-light">
              <svg class="w-4 h-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                <path d="M12 2.25a.75.75 0 01.75.75v2.25a.75.75 0 01-1.5 0V3a.75.75 0 01.75-.75zM7.5 12a4.5 4.5 0 119 0 4.5 4.5 0 01-9 0zM18.894 6.166a.75.75 0 00-1.06-1.06l-1.591 1.59a.75.75 0 101.06 1.061l1.591-1.59zM21.75 12a.75.75 0 01-.75.75h-2.25a.75.75 0 010-1.5H21a.75.75 0 01.75.75zM17.834 18.894a.75.75 0 001.06-1.06l-1.59-1.591a.75.75 0 10-1.061 1.06l1.59 1.591zM12 18a.75.75 0 01.75.75V21a.75.75 0 01-1.5 0v-2.25A.75.75 0 0112 18zM7.758 17.303a.75.75 0 00-1.061-1.06l-1.591 1.59a.75.75 0 001.06 1.061l1.591-1.59zM6 12a.75.75 0 01-.75.75H3a.75.75 0 010-1.5h2.25A.75.75 0 016 12zM6.697 7.757a.75.75 0 001.06-1.06l-1.59-1.591a.75.75 0 00-1.061 1.06l1.59 1.591z"/>
              </svg>
              Light
            </button>
            <button onclick="__setThemeMode('dark');" class="btn btn-sm flex-1" id="mode-dark">
              <svg class="w-4 h-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                <path d="M21.64,13a1,1,0,0,0-1.05-.14,8.05,8.05,0,0,1-3.37.73A8.15,8.15,0,0,1,9.08,5.49a8.59,8.59,0,0,1,.25-2A1,1,0,0,0,8,2.36,10.14,10.14,0,1,0,22,14.05,1,1,0,0,0,21.64,13Z"/>
              </svg>
              Dark
            </button>
          </div>
        </div>
        <!-- 2. Themes Accordion (Open by default) -->
        <div class="collapse collapse-arrow border-b border-base-300 rounded-none">
          <input type="checkbox" id="themes-accordion" checked />
          <div class="collapse-title px-0 py-3 min-h-0">
            <div class="flex items-center gap-2">
              <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zm0 0h12a2 2 0 002-2v-4a2 2 0 00-2-2h-2.343M11 7.343l1.657-1.657a2 2 0 012.828 0l2.829 2.829a2 2 0 010 2.828l-8.486 8.485M7 17h.01" />
              </svg>
              <span class="text-sm font-semibold">Themes</span>
            </div>
          </div>
          <div class="collapse-content px-0 pb-3">
            <ul class="max-h-64 overflow-y-auto space-y-1" id="themeMenu">
              <li><!-- Will be filled by build.mjs with theme options --></li>
            </ul>
          </div>
        </div>
        <!-- 3. Theme Parameters -->
        <div class="collapse collapse-arrow border-b border-base-300 rounded-none">
          <input type="checkbox" id="theme-params-accordion" />
          <div class="collapse-title px-0 py-3 min-h-0">
            <div class="flex items-center gap-2">
              <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4" />
              </svg>
              <span class="text-sm font-semibold">Theme Parameters</span>
            </div>
          </div>
          <div class="collapse-content px-0 pb-3">
            <div class="space-y-4">
              <!-- Custom Settings Toggle -->
              <div class="flex items-center justify-between">
                <div class="flex items-center gap-2">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 94 90" fill="none" stroke="currentColor" stroke-width="2" class="w-5 h-5 evo-logo" id="evo-logo-mini">
                    <path d="m37.361 37.392 6.783 16.393 6.792-16.393M32.017 45.49h-7.908M33.161 37.392h-9.3v16.393h9.293M61.732 37.392c4.239 0 7.675 3.51 7.675 8.097 0 4.588-3.437 8.296-7.676 8.296-4.239 0-7.675-3.708-7.675-8.296 0-4.587 3.435-8.097 7.674-8.097h.002z"/>
                  </svg>
                  <div>
                    <div class="text-sm font-medium">Custom Settings</div>
                    <div class="text-xs opacity-60">Apply my customization</div>
                  </div>
                </div>
                <input type="checkbox" class="toggle toggle-primary toggle-sm" id="evo-toggle" onchange="__toggleEvoCustom()" />
              </div>
              <!-- Theme Rotation Speed -->
              <div id="evo-speed-section" class="pt-3 border-t border-base-300">
                <div class="text-xs font-bold text-base-content/50 uppercase tracking-wider mb-2">Theme Rotation</div>
                <div class="space-y-2">
                  <div class="flex items-center justify-between mb-2">
                    <span class="text-xs font-mono badge badge-ghost badge-sm" id="evo-speed-display">3s</span>
                  </div>
                  <input type="range" min="0" max="10" value="3" step="0.1" class="range range-primary range-xs" id="evo-speed-slider" oninput="__updateEvoSpeed(this.value)" />
                  <div class="flex justify-between text-xs opacity-50 px-1">
                    <span>Off</span>
                    <span>2.5s</span>
                    <span>5s</span>
                    <span>7.5s</span>
                    <span>10s</span>
                  </div>
                </div>
              </div>
              <!-- 3D Depth -->
              <div class="flex items-center justify-between pt-3 border-t border-base-300">
                <div class="flex items-center gap-2">
                  <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 opacity-60" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8-4m0-10L4 7m8 4v10M4 7v10l8 4" />
                  </svg>
                  <div>
                    <div class="text-sm font-medium">3D Depth</div>
                    <div class="text-xs opacity-60">Shadows and depth</div>
                  </div>
                </div>
                <input type="checkbox" class="toggle toggle-sm toggle-primary" id="system-depth-toggle" checked />
              </div>
              <!-- Film Grain -->
              <div class="flex items-center justify-between">
                <div class="flex items-center gap-2">
                  <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 opacity-60" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zm0 0h12a2 2 0 002-2v-4a2 2 0 00-2-2h-2.343M11 7.343l1.657-1.657a2 2 0 012.828 0l2.829 2.829a2 2 0 010 2.828l-8.486 8.485M7 17h.01" />
                  </svg>
                  <div>
                    <div class="text-sm font-medium">Film Grain</div>
                    <div class="text-xs opacity-60">Texture overlay</div>
                  </div>
                </div>
                <input type="checkbox" class="toggle toggle-sm toggle-primary" id="system-noise-toggle" />
              </div>
              <!-- Glass Effect -->
              <div class="flex items-center justify-between">
                <div class="flex items-center gap-2">
                  <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 opacity-60" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 7h16M4 12h10M4 17h6" />
                  </svg>
                  <div>
                    <div class="text-sm font-medium">Glass Effect</div>
                    <div class="text-xs opacity-60">Blurred translucent surfaces</div>
                  </div>
                </div>
                <input type="checkbox" class="toggle toggle-sm toggle-primary" id="system-glass-toggle" onchange="__toggleGlass(this.checked)" />
              </div>
            </div>
          </div>
        </div>
        <!-- 4. Background -->
        <div class="collapse collapse-arrow border-b border-base-300 rounded-none">
          <input type="checkbox" id="background-accordion" />
          <div class="collapse-title px-0 py-3 min-h-0">
            <div class="flex items-center gap-2">
              <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
              </svg>
              <span class="text-sm font-semibold">Background</span>
            </div>
          </div>
          <div class="collapse-content px-0 pb-3">
            <ul class="space-y-1">
              <li>
                <button onclick="__setBackground('none')" class="flex w-full items-center gap-2 px-3 py-1.5 rounded-lg transition-all hover:shadow-sm bg-item" data-bg="none">
                  <span class="text-lg">⬜</span>
                  <span class="flex-1 text-left text-sm">None</span>
                  <svg class="h-3.5 w-3.5 flex-shrink-0 opacity-0 bg-checkmark" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                  </svg>
                </button>
              </li>
              <li>
                <button onclick="__setBackground('transparent')" class="flex w-full items-center gap-2 px-3 py-1.5 rounded-lg transition-all hover:shadow-sm bg-item" data-bg="transparent">
                  <span class="text-lg">💎</span>
                  <span class="flex-1 text-left text-sm">Transparent (Glass)</span>
                  <svg class="h-3.5 w-3.5 flex-shrink-0 opacity-0 bg-checkmark" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                  </svg>
                </button>
              </li>
              <li class="pt-2">
                <div class="text-xs opacity-60 px-3 mb-1">Animated</div>
              </li>
              <li>
                <button onclick="__setBackground('liquid')" class="flex w-full items-center gap-2 px-3 py-1.5 rounded-lg transition-all hover:shadow-sm bg-item" data-bg="liquid">
                  <span class="text-lg">🌊</span>
                  <span class="flex-1 text-left text-sm">Liquid Glass (Default)</span>
                  <svg class="h-3.5 w-3.5 flex-shrink-0 opacity-0 bg-checkmark" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                  </svg>
                </button>
              </li>
              <li>
                <button onclick="__setBackground('gradient-spheres')" class="flex w-full items-center gap-2 px-3 py-1.5 rounded-lg transition-all hover:shadow-sm bg-item" data-bg="gradient-spheres">
                  <span class="text-lg">🌈</span>
                  <span class="flex-1 text-left text-sm">Gradient Spheres</span>
                  <svg class="h-3.5 w-3.5 flex-shrink-0 opacity-0 bg-checkmark" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                  </svg>
                </button>
              </li>
              <li>
                <button onclick="__setBackground('magic')" class="flex w-full items-center gap-2 px-3 py-1.5 rounded-lg transition-all hover:shadow-sm bg-item" data-bg="magic">
                  <span class="text-lg">🪄</span>
                  <span class="flex-1 text-left text-sm">Magic Aurora</span>
                  <svg class="h-3.5 w-3.5 flex-shrink-0 opacity-0 bg-checkmark" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                  </svg>
                </button>
              </li>
              <li>
                <button onclick="__setBackground('colorful-dots')" class="flex w-full items-center gap-2 px-3 py-1.5 rounded-lg transition-all hover:shadow-sm bg-item" data-bg="colorful-dots">
                  <span class="text-lg">✨</span>
                  <span class="flex-1 text-left text-sm">Colorful Dots</span>
                  <svg class="h-3.5 w-3.5 flex-shrink-0 opacity-0 bg-checkmark" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                  </svg>
                </button>
              </li>
              <li>
                <button onclick="__setBackground('cosmic-dream')" class="flex w-full items-center gap-2 px-3 py-1.5 rounded-lg transition-all hover:shadow-sm bg-item" data-bg="cosmic-dream">
                  <span class="text-lg">🌌</span>
                  <span class="flex-1 text-left text-sm">Cosmic Dream</span>
                  <svg class="h-3.5 w-3.5 flex-shrink-0 opacity-0 bg-checkmark" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                  </svg>
                </button>
              </li>
            </ul>
          </div>
        </div>
        <!-- 5. Solid Color Layer -->
        <div class="collapse collapse-arrow rounded-none">
          <input type="checkbox" id="solid-color-accordion" />
          <div class="collapse-title px-0 py-3 min-h-0">
            <div class="flex items-center gap-2">
              <span class="text-lg">🎨</span>
              <span class="text-sm font-semibold">Solid Color Layer</span>
              <span id="hue-value-mini" class="text-xs font-mono badge badge-sm ml-auto">220°</span>
            </div>
          </div>
          <div class="collapse-content px-0 pb-3">
            <div class="space-y-3">
              <div>
                <div class="text-xs opacity-60 mb-2 flex justify-between">
                  <span>Hue</span>
                  <span id="hue-value" class="font-mono">220°</span>
                </div>
                <input type="range" min="0" max="360" value="220" step="1" class="rainbow-slider w-full h-8 rounded-lg cursor-pointer" id="hue-slider" oninput="__applySolidColorRealtime()" />
              </div>
              <div>
                <div class="text-xs opacity-60 mb-2 flex justify-between">
                  <span>Opacity</span>
                  <span id="opacity-value" class="font-mono">100%</span>
                </div>
                <input type="range" min="0" max="100" value="100" step="1" class="opacity-slider w-full h-8 rounded-lg cursor-pointer" id="opacity-slider" oninput="__applySolidColorRealtime()" />
              </div>
              <button onclick="__saveSolidColorToStorage()" class="btn btn-sm btn-block btn-primary">
                💾 Save to Storage
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</aside>

<script>
  // Theme Mode Selector
  let __themeModeMediaQuery;

  function __resolveThemeForMode(mode) {
    if (typeof window.__getLastThemeForMode === 'function') {
      return window.__getLastThemeForMode(mode);
    }
    return mode === 'dark' ? 'dark' : 'light';
  }

  function __handleSystemModeChange(event) {
    if ((localStorage.getItem('evo-theme-mode') || 'system') !== 'system') {
      return;
    }
    const resolvedMode = event.matches ? 'dark' : 'light';
    const theme = __resolveThemeForMode(resolvedMode);
    if (theme) {
      window.__setTheme(theme);
    }
    window.__filterThemesByMode && window.__filterThemesByMode('system');
  }

  window.__setThemeMode = function(mode) {
    localStorage.setItem('evo-theme-mode', mode);
    localStorage.setItem('theme-mode', mode);

    // Update active button
    ['system', 'light', 'dark'].forEach(m => {
      const btn = document.getElementById(`mode-${m}`);
      if (btn) {
        if (m === mode) {
          btn.classList.add('btn-primary');
        } else {
          btn.classList.remove('btn-primary');
        }
      }
    });

    if (__themeModeMediaQuery) {
      if (typeof __themeModeMediaQuery.removeEventListener === 'function') {
        __themeModeMediaQuery.removeEventListener('change', __handleSystemModeChange);
      } else if (typeof __themeModeMediaQuery.removeListener === 'function') {
        __themeModeMediaQuery.removeListener(__handleSystemModeChange);
      }
      __themeModeMediaQuery = null;
    }

    let themeToApply = null;

    if (mode === 'system') {
      __themeModeMediaQuery = window.matchMedia('(prefers-color-scheme: dark)');
      const prefersDark = __themeModeMediaQuery.matches;
      themeToApply = __resolveThemeForMode(prefersDark ? 'dark' : 'light');

      if (__themeModeMediaQuery) {
        if (typeof __themeModeMediaQuery.addEventListener === 'function') {
          __themeModeMediaQuery.addEventListener('change', __handleSystemModeChange);
        } else if (typeof __themeModeMediaQuery.addListener === 'function') {
          __themeModeMediaQuery.addListener(__handleSystemModeChange);
        }
      }
    } else if (mode === 'light' || mode === 'dark') {
      themeToApply = __resolveThemeForMode(mode);
    }

    if (themeToApply) {
      window.__setTheme(themeToApply);
    }

    window.__filterThemesByMode && window.__filterThemesByMode(mode);
  };
  
  // Evo Custom Settings Toggle - apply/remove custom theme settings
  window.__toggleEvoCustom = function() {
    const toggle = document.getElementById('evo-toggle');
    const logo = document.getElementById('evo-logo');
    const logoMini = document.getElementById('evo-logo-mini');
    const isActive = toggle && toggle.checked;
    
    // Save state
    localStorage.setItem('evo-custom-active', isActive);
    
    // Update logo glow (both main and mini)
    [logo, logoMini].forEach(el => {
      if (el) {
        if (isActive) {
          el.classList.add('evo-active');
        } else {
          el.classList.remove('evo-active');
        }
      }
    });
    
    // Apply or remove custom theme variables
    if (isActive) {
      // Apply custom settings from localStorage
      window.__applyCustomSettings && window.__applyCustomSettings();
    } else {
      // Remove custom settings, use theme defaults
      window.__removeCustomSettings && window.__removeCustomSettings();
    }
  };
  
  // Theme Rotation Speed Update - independent of custom settings
  window.__updateEvoSpeed = function(speed) {
    let speedNum = parseFloat(speed);
    if (!Number.isFinite(speedNum)) {
      speedNum = 0;
    }
    const display = document.getElementById('evo-speed-display');
    if (display) {
      const label = speedNum === 0 ? 'Off' : `${Number.isInteger(speedNum) ? speedNum : speedNum.toFixed(1)}s`;
      display.textContent = label;
    }

    // Save speed
    localStorage.setItem('evo-rotation-speed', String(speedNum));
    localStorage.setItem('evo-speed', String(speedNum));

    // Stop any existing rotation
    window.__stopEvoAuto && window.__stopEvoAuto();

    // Start rotation if speed > 0
    if (speedNum > 0) {
      window.__startEvoAuto && window.__startEvoAuto(speedNum);
    }

    window.__updateEvoUI && window.__updateEvoUI(speedNum);

    // Update transition duration
    window.__updateTransitionDuration && window.__updateTransitionDuration(speedNum);
  };
  
  // Toggle 3D Depth effect
  window.__toggleDepth = function(enabled) {
    const value = enabled ? '1' : '0';
    document.documentElement.style.setProperty('--depth', value);
    localStorage.setItem('evo-depth', value);
  };
  
  // Toggle Film Grain effect
  window.__toggleNoise = function(enabled) {
    const value = enabled ? '1' : '0';
    document.documentElement.style.setProperty('--noise', value);
    localStorage.setItem('evo-noise', value);
  };
  

  // Toggle Glass Effect
  window.__toggleGlass = function(enabled) {
    const value = enabled ? '1' : '0';
    document.documentElement.style.setProperty('--glass', value);
    localStorage.setItem('evo-glass', value);

    // Apply glass effect to body if enabled
    if (enabled) {
      document.body.classList.add('glass-effect-enabled');
    } else {
      document.body.classList.remove('glass-effect-enabled');
    }
  };

  // Theme panel interactions
  (function() {
    const themeButton = document.getElementById('theme-button');
    const themePanel = document.getElementById('theme-panel');
    const overlay = document.getElementById('theme-panel-overlay');
    if (!themeButton || !themePanel || !overlay) {
      return;
    }

    const closeButtons = themePanel.querySelectorAll('[data-close-theme-panel]');
    let isOpen = false;
    let lastFocusedElement = null;

    function setExpandedState(open) {
      themeButton.setAttribute('aria-expanded', open ? 'true' : 'false');
      themePanel.setAttribute('aria-hidden', open ? 'false' : 'true');
      overlay.classList.toggle('opacity-100', open);
      overlay.classList.toggle('opacity-0', !open);
      overlay.classList.toggle('pointer-events-auto', open);
      overlay.classList.toggle('pointer-events-none', !open);
      themePanel.classList.toggle('translate-x-full', !open);
      document.body.classList.toggle('theme-panel-open', open);
    }

    function openPanel() {
      if (isOpen) return;
      lastFocusedElement = document.activeElement instanceof HTMLElement ? document.activeElement : null;
      isOpen = true;
      setExpandedState(true);

      const focusTarget = themePanel.querySelector('[data-close-theme-panel]') || themePanel.querySelector('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');
      if (focusTarget instanceof HTMLElement) {
        focusTarget.focus({ preventScroll: true });
      }
    }

    function closePanel() {
      if (!isOpen) return;
      isOpen = false;
      setExpandedState(false);

      if (lastFocusedElement) {
        lastFocusedElement.focus({ preventScroll: true });
      }
    }

    themeButton.addEventListener('click', event => {
      event.preventDefault();
      if (isOpen) {
        closePanel();
      } else {
        openPanel();
      }
    });

    overlay.addEventListener('click', () => closePanel());
    closeButtons.forEach(btn => btn.addEventListener('click', () => closePanel()));

    document.addEventListener('keydown', event => {
      if (!isOpen) return;
      if (event.key === 'Escape') {
        event.preventDefault();
        closePanel();
      }
      if (event.key === 'Tab') {
        const focusable = themePanel.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');
        if (focusable.length === 0) {
          event.preventDefault();
          return;
        }
        const focusArray = Array.from(focusable).filter(el => !el.hasAttribute('disabled'));
        if (focusArray.length === 0) {
          event.preventDefault();
          return;
        }
        const first = focusArray[0];
        const last = focusArray[focusArray.length - 1];
        const active = document.activeElement;
        if (event.shiftKey) {
          if (active === first || !themePanel.contains(active)) {
            event.preventDefault();
            last.focus();
          }
        } else {
          if (active === last) {
            event.preventDefault();
            first.focus();
          }
        }
      }
    });
  })();

  // Theme management - simplified
  (function() {
    function getThemeMode(theme) {
      const lightThemes = ['light', 'cupcake', 'bumblebee', 'emerald', 'corporate', 'retro', 'valentine', 'garden', 'pastel', 'fantasy', 'wireframe', 'cmyk', 'autumn', 'acid', 'lemonade', 'winter', 'nord', 'lofi', 'cyberpunk', 'light-evo'];
      return lightThemes.includes(theme) ? 'light' : 'dark';
    }
    
    function updateThemeIcon() {
      const currentTheme = document.documentElement.getAttribute('data-theme') || '[[THEME]]';
      const lightIcon = document.getElementById('theme-icon-light');
      const darkIcon = document.getElementById('theme-icon-dark');

      const themeMode = getThemeMode(currentTheme);
      if (themeMode === 'dark') {
        if (lightIcon) lightIcon.classList.add('hidden');
        if (darkIcon) darkIcon.classList.remove('hidden');
      } else {
        if (lightIcon) lightIcon.classList.remove('hidden');
        if (darkIcon) darkIcon.classList.add('hidden');
      }
    }
    
    function updateActiveIndicators() {
      const currentTheme = document.documentElement.getAttribute('data-theme') || '[[THEME]]';
      const currentBackground = localStorage.getItem('evo-background') || 'liquid';

      // Update theme checkmarks
      document.querySelectorAll('[data-set-theme]').forEach(btn => {
        const checkmark = btn.querySelector('.theme-checkmark');
        if (checkmark) {
          if (btn.dataset.setTheme === currentTheme) {
            checkmark.style.opacity = '1';
            btn.classList.add('active');
          } else {
            checkmark.style.opacity = '0';
            btn.classList.remove('active');
          }
        }
      });

      const themeSelect = document.getElementById('settings_theme');
      if (themeSelect) {
        const option = themeSelect.querySelector(`option[value="${currentTheme}"]`);
        if (option) {
          themeSelect.value = currentTheme;
        }
      }

      // Update background buttons
      document.querySelectorAll('[data-bg]').forEach(btn => {
        if (btn.dataset.bg === currentBackground) {
          btn.classList.add('btn-active');
        } else {
          btn.classList.remove('btn-active');
        }
      });

      const backgroundSelect = document.getElementById('settings_background');
      if (backgroundSelect) {
        const option = backgroundSelect.querySelector(`option[value="${currentBackground}"]`);
        if (option) {
          backgroundSelect.value = currentBackground;
        }
      }
    }

    window.__syncThemeUI = function() {
      updateThemeIcon();
      updateActiveIndicators();
    };

    // Initialize
    document.addEventListener('DOMContentLoaded', function() {
      window.__syncThemeUI && window.__syncThemeUI();

      // Initialize theme mode
      const savedMode = localStorage.getItem('evo-theme-mode') || 'system';
      window.__setThemeMode(savedMode);
      
      // Initialize Evo Custom Settings state
      const evoToggle = document.getElementById('evo-toggle');
      const savedCustomState = localStorage.getItem('evo-custom-active') === 'true';
      
      if (evoToggle) {
        evoToggle.checked = savedCustomState;
        if (savedCustomState) {
          // Update logos (both main and mini)
          document.getElementById('evo-logo')?.classList.add('evo-active');
          document.getElementById('evo-logo-mini')?.classList.add('evo-active');
          // Apply custom settings
          window.__applyCustomSettings && window.__applyCustomSettings();
        }
      }
      
      // Initialize Theme Rotation Speed
      const defaultRotationSpeed = 3;
      const storedRotationSpeed = localStorage.getItem('evo-rotation-speed');
      const storedEvoSpeed = localStorage.getItem('evo-speed');
      let savedSpeed = defaultRotationSpeed;

      if (storedRotationSpeed !== null) {
        savedSpeed = parseFloat(storedRotationSpeed);
      } else if (storedEvoSpeed !== null) {
        savedSpeed = parseFloat(storedEvoSpeed);
        localStorage.setItem('evo-rotation-speed', storedEvoSpeed);
      }

      if (!Number.isFinite(savedSpeed)) {
        savedSpeed = defaultRotationSpeed;
      }

      localStorage.setItem('evo-rotation-speed', String(savedSpeed));
      localStorage.setItem('evo-speed', String(savedSpeed));
      const speedSlider = document.getElementById('evo-speed-slider');
      const speedDisplay = document.getElementById('evo-speed-display');

      if (speedSlider) {
        speedSlider.value = savedSpeed;
      }
      if (speedDisplay) {
        const label = savedSpeed === 0 ? 'Off' : `${Number.isInteger(savedSpeed) ? savedSpeed : savedSpeed.toFixed(1)}s`;
        speedDisplay.textContent = label;
      }

      window.__updateEvoUI && window.__updateEvoUI(savedSpeed);

      // Start rotation if speed > 0
      if (savedSpeed > 0) {
        window.__startEvoAuto && window.__startEvoAuto(savedSpeed);
      } else {
        window.__stopEvoAuto && window.__stopEvoAuto();
      }
      
      // Initialize Depth and Noise from localStorage
      const savedDepth = localStorage.getItem('evo-depth') || '1';
      const savedNoise = localStorage.getItem('evo-noise') || '0';
      
      const depthToggle = document.getElementById('system-depth-toggle');
      const noiseToggle = document.getElementById('system-noise-toggle');
      
      if (depthToggle) {
        depthToggle.checked = savedDepth === '1';
        document.documentElement.style.setProperty('--depth', savedDepth);
      }
      
      if (noiseToggle) {
        noiseToggle.checked = savedNoise === '1';
        document.documentElement.style.setProperty('--noise', savedNoise);
      }

      // Initialize Glass Effect
      const savedGlass = localStorage.getItem('evo-glass') || '0';
      const glassToggle = document.getElementById('system-glass-toggle');

      if (glassToggle) {
        glassToggle.checked = savedGlass === '1';
        window.__toggleGlass(savedGlass === '1');
      }
    });
    
    // Update when theme/background changes
    const originalSetTheme = window.__setTheme;
    const originalSetBackground = window.__setBackground;
    
    if (originalSetTheme) {
      window.__setTheme = function(theme) {
        originalSetTheme(theme);
        setTimeout(() => {
          window.__syncThemeUI && window.__syncThemeUI();
        }, 100);
      };
    }
    
    if (originalSetBackground) {
      window.__setBackground = function(bg) {
        originalSetBackground(bg);
        setTimeout(updateActiveIndicators, 100);
      };
    }
  })();

  // Filter themes based on selected mode
  window.__filterThemesByMode = function(mode) {
    const themeMenu = document.getElementById('themeMenu');
    if (!themeMenu) {
      console.error('❌ Theme menu not found!');
      return;
    }

    const allThemeItems = themeMenu.querySelectorAll('li.theme-item');
    let shownCount = 0;

    allThemeItems.forEach(item => {
      const button = item.querySelector('[data-set-theme]');
      if (!button) return;

      const themeName = button.getAttribute('data-set-theme');
      const themeMode = window.__getThemeModeByName(themeName);
      let shouldShow = false;

      if (mode === 'system') {
        // System mode: показуємо тільки одну Evo тему (в залежності від поточного режиму системи)
        const isDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
        if (isDark) {
          shouldShow = themeName === 'dark-evo';
        } else {
          shouldShow = themeName === 'light-evo';
        }
      } else if (mode === 'light') {
        // Light mode: показуємо всі light теми
        shouldShow = (themeMode === 'light');
      } else if (mode === 'dark') {
        // Dark mode: показуємо всі dark теми
        shouldShow = (themeMode === 'dark');
      }

      if (shouldShow) {
        item.style.display = '';
        shownCount++;
      } else {
        item.style.display = 'none';
      }
    });
    
    if (shownCount === 0) {
      console.warn(`⚠️ No themes available for mode "${mode}"`);
    }
  };
  
  // Helper function to determine theme mode
  window.__getThemeModeByName = function(themeName) {
    const lightThemes = ['light-evo', 'light', 'cupcake', 'bumblebee', 'emerald', 'corporate', 'retro', 'valentine', 'garden', 'lofi', 'pastel', 'fantasy', 'wireframe', 'cmyk', 'autumn', 'acid', 'lemonade', 'winter', 'nord'];
    return lightThemes.includes(themeName) ? 'light' : 'dark';
  };

  // Initialize theme filter on page load
  if (typeof window !== 'undefined') {
    // Run after DOM is ready
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', function() {
        const currentMode = localStorage.getItem('evo-theme-mode') || 'system';
        window.__filterThemesByMode && window.__filterThemesByMode(currentMode);
      });
    } else {
      setTimeout(function() {
        const currentMode = localStorage.getItem('evo-theme-mode') || 'system';
        window.__filterThemesByMode && window.__filterThemesByMode(currentMode);
      }, 100);
    }
  }

</script>

<style>
  /* Evo Logo Glow Effect */
  #evo-logo.evo-active,
  #evo-logo-mini.evo-active {
    position: relative;
  }
  
  #evo-logo.evo-active svg,
  #evo-logo-mini.evo-active {
    filter: drop-shadow(0 0 8px oklch(var(--p))) drop-shadow(0 0 16px oklch(var(--p) / 0.5));
    animation: pulse-glow 2s ease-in-out infinite;
  }
  
  @keyframes pulse-glow {
    0%, 100% {
      filter: drop-shadow(0 0 8px oklch(var(--p))) drop-shadow(0 0 16px oklch(var(--p) / 0.5));
    }
    50% {
      filter: drop-shadow(0 0 12px oklch(var(--p))) drop-shadow(0 0 24px oklch(var(--p) / 0.7));
    }
  }

  body.theme-panel-open {
    overflow: hidden;
  }
</style>

